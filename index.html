<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>極致山水 · 最終完美版</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Noto+Serif+TC:wght@400;500;700;900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg: #F2F2F2;
            --ticket-bg: #FFFFFF;
            --ink: #111111;
            --placeholder: #E0E0E0;
            --line: #E5E5E5;
        }

        /* ✨ FIX: 初始透明度設為 0，防止載入時閃爍 */
        body {
            background-color: var(--bg);
            color: var(--ink);
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            overflow-x: hidden;
            padding-bottom: 80px;
            opacity: 0; 
            transition: opacity 0.8s ease-out;
        }

        @media (min-width: 1024px) {
            body { padding-bottom: 0; }
        }

        .font-serif-num { 
            font-family: 'Noto Serif TC', serif; 
            letter-spacing: 0.02em; 
        }

        /* --- Components --- */

        .input-group {
            margin-bottom: 2.5rem;
            position: relative;
        }
        @media (min-width: 1024px) {
            .input-group { margin-bottom: 3rem; }
        }
        
        .raw-input {
            width: 100%;
            background: transparent;
            border: none;
            border-bottom: 1px solid var(--line);
            font-family: 'Noto Serif TC', serif;
            font-size: 2rem;
            font-weight: 500;
            color: var(--ink);
            padding: 0.5rem 0;
            border-radius: 0;
            transition: border-color 0.4s ease;
        }
        @media (min-width: 1024px) {
            .raw-input { font-size: 2.5rem; }
        }
        
        .raw-input:focus {
            outline: none;
            border-bottom-color: var(--ink);
        }

        .raw-input::placeholder {
            color: var(--placeholder);
            font-weight: 300;
        }

        .label-tiny {
            font-size: 0.75rem;
            font-weight: 500;
            letter-spacing: 0.08em;
            color: #888;
            margin-bottom: 0.5rem;
            display: block;
            font-family: 'Inter', sans-serif;
            text-transform: uppercase;
        }

        .quick-price-box {
            background-color: #111;
            color: #fff;
            padding: 1.25rem 1.5rem;
            border-radius: 2px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.2s, box-shadow 0.2s;
            margin-bottom: 2.5rem;
            border-left: 4px solid #fff;
        }
        .quick-price-box:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
        }

        .ticket {
            background: var(--ticket-bg);
            box-shadow: 0 20px 40px rgba(0,0,0,0.06);
            padding: 2rem;
            position: relative;
            min-height: auto;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        @media (min-width: 1024px) {
            .ticket {
                padding: 3.5rem;
                min-height: 640px;
                box-shadow: 0 40px 80px rgba(0,0,0,0.06);
            }
        }
        
        .data-value {
            font-family: 'Noto Serif TC', serif;
            transition: color 0.3s;
        }
        .data-value.empty {
            color: var(--placeholder);
            font-weight: 300;
        }
        .data-value.filled {
            color: var(--ink);
            font-weight: 700;
        }

        .price-row {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            padding: 1.25rem 0;
            border-bottom: 1px solid var(--line);
        }
        .price-row:last-child { border-bottom: none; }

        .sticky-footer {
            position: fixed;
            bottom: 0; left: 0; right: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-top: 1px solid #E5E5E5;
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
            box-shadow: 0 -10px 20px rgba(0,0,0,0.02);
            transform: translateY(100%);
            transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .sticky-footer.visible {
            transform: translateY(0);
        }
        @media (min-width: 1024px) {
            .sticky-footer { display: none; }
        }

        dialog { 
            border: none;
            padding: 0; 
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            border-radius: 4px;
            width: 90%;
            max-width: 400px;
        }
        dialog::backdrop { background: rgba(255,255,255, 0.8); }
        
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    </style>
</head>
<body class="min-h-screen">

    <div class="max-w-6xl w-full mx-auto lg:flex lg:items-center lg:justify-center lg:min-h-screen p-6 lg:p-0">
        
        <div class="w-full grid grid-cols-1 lg:grid-cols-2 gap-12 lg:gap-32">
            
            <!-- Left: Input -->
            <div class="flex flex-col justify-center lg:pl-12 order-1">
                <header class="mb-10 lg:mb-16 mt-4 lg:mt-0">
                    <h1 class="text-4xl lg:text-5xl font-bold leading-tight tracking-tight mb-2 font-serif-num text-black">
                        極致山水
                    </h1>
                    <p class="text-gray-400 font-light tracking-widest text-xs lg:text-sm">數位報價系統 PRO</p>
                </header>

                <div class="space-y-4">
                    <div class="grid grid-cols-2 gap-8 lg:gap-12">
                        <div class="input-group">
                            <label class="label-tiny">長度 (CM)</label>
                            <!-- ✨ FIX: 加入 step="0.1" 允許小數點輸入 -->
                            <input type="number" id="length" class="raw-input" placeholder="00" inputmode="decimal" step="0.1">
                        </div>
                        <div class="input-group">
                            <label class="label-tiny">寬度 (CM)</label>
                            <input type="number" id="width" class="raw-input" placeholder="00" inputmode="decimal" step="0.1">
                        </div>
                    </div>

                    <div class="input-group">
                        <label class="label-tiny">框條單價 ($)</label>
                        <input type="number" id="framePrice" class="raw-input" placeholder="0.0" inputmode="decimal" step="0.1">
                    </div>

                    <!-- Quick Price Box (Frame Only) -->
                    <div class="quick-price-box">
                        <div>
                            <span class="text-[10px] font-bold tracking-widest text-gray-400 block mb-1">FRAME ONLY</span>
                            <span class="text-xs text-gray-500 font-sans">純框價格 (不含背板)</span>
                        </div>
                        <div class="font-serif-num text-3xl tracking-tight">
                            $ <span id="quick-price-display">0</span>
                        </div>
                    </div>
                    
                    <div class="input-group">
                        <div class="flex justify-between mb-2">
                            <label class="label-tiny">優惠折扣</label>
                            <span class="font-serif-num text-lg"><span id="discountDisplay">100</span>%</span>
                        </div>
                        <div class="py-2">
                            <input type="range" id="discountRange" min="50" max="100" value="100" step="5" class="w-full h-[1px] bg-gray-300 appearance-none cursor-pointer accent-black">
                        </div>
                    </div>
                </div>

                <div class="mt-8 lg:mt-12 flex gap-4">
                    <button onclick="window.print()" class="bg-black text-white px-8 py-4 lg:py-5 text-sm font-bold tracking-widest hover:bg-gray-800 transition-colors w-full flex justify-between items-center group rounded-sm shadow-lg active:scale-[0.98] transition-transform">
                        <span>列印單據</span>
                        <span class="group-hover:translate-x-1 transition-transform">→</span>
                    </button>
                    <button onclick="APP.toggleSettings()" class="border border-gray-200 px-5 lg:px-6 py-4 lg:py-5 hover:border-black transition-colors text-gray-400 hover:text-black rounded-sm">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
                    </button>
                </div>
            </div>

            <!-- Right: Receipt -->
            <div class="flex items-center justify-center order-2 mb-10 lg:mb-0">
                <div id="receipt-container" class="ticket w-full max-w-md mx-auto">
                    
                    <div>
                        <div class="flex justify-end mb-8 lg:mb-10">
                            <div class="text-right">
                                <div class="text-[10px] font-bold uppercase tracking-widest text-gray-400 mb-1">Date</div>
                                <div id="receipt-date" class="font-serif-num text-sm"></div>
                            </div>
                        </div>

                        <div class="bg-gray-50 p-6 lg:p-8 mb-8 lg:mb-12 rounded-sm border border-gray-100">
                            <div class="grid grid-cols-2 gap-6 lg:gap-8 text-sm">
                                <div>
                                    <div class="text-[10px] font-bold uppercase text-gray-400 mb-2">Dimensions</div>
                                    <div class="font-serif-num text-lg lg:text-xl">
                                        <span id="disp-l" class="data-value empty">00</span> × <span id="disp-w" class="data-value empty">00</span>
                                        <span class="text-xs text-gray-400 ml-1 font-sans">CM</span>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="text-[10px] font-bold uppercase text-gray-400 mb-2">Unit Price</div>
                                    <div class="font-serif-num text-lg lg:text-xl">
                                        $ <span id="disp-p" class="data-value empty">0.0</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="space-y-4">
                            <!-- 1 -->
                            <div class="price-row group">
                                <div>
                                    <div class="text-base lg:text-lg font-bold text-gray-900">
                                        <span class="font-serif-num mr-2">1.</span> 壓克力裝裱
                                    </div>
                                    <div class="text-[10px] text-gray-400 font-sans tracking-wide mt-1 pl-5 lg:pl-6">ACRYLIC GLAZING</div>
                                </div>
                                <div class="text-right">
                                    <div id="old-price-a" class="text-[10px] text-gray-300 line-through h-4 font-serif-num"></div>
                                    <div class="font-serif-num text-2xl lg:text-3xl">
                                        $ <span id="price-a" class="data-value empty">00,000</span>
                                    </div>
                                </div>
                            </div>
                            <!-- 2 -->
                            <div class="price-row group">
                                <div>
                                    <div class="text-base lg:text-lg font-bold text-gray-900">
                                        <span class="font-serif-num mr-2">2.</span> PS 塑膠板
                                    </div>
                                    <div class="text-[10px] text-gray-400 font-sans tracking-wide mt-1 pl-5 lg:pl-6">POLYSTYRENE</div>
                                </div>
                                <div class="text-right">
                                    <div id="old-price-b" class="text-[10px] text-gray-300 line-through h-4 font-serif-num"></div>
                                    <div class="font-serif-num text-2xl lg:text-3xl">
                                        $ <span id="price-b" class="data-value empty">00,000</span>
                                    </div>
                                </div>
                            </div>
                            <!-- 3 -->
                            <div class="price-row group">
                                <div>
                                    <div class="text-base lg:text-lg font-bold text-gray-900">
                                        <span class="font-serif-num mr-2">3.</span> 藝術卡紙
                                    </div>
                                    <div class="text-[10px] text-gray-400 font-sans tracking-wide mt-1 pl-5 lg:pl-6">MUSEUM MATBOARD</div>
                                </div>
                                <div class="text-right">
                                    <div id="old-price-c" class="text-[10px] text-gray-300 line-through h-4 font-serif-num"></div>
                                    <div class="font-serif-num text-2xl lg:text-3xl">
                                        $ <span id="price-c" class="data-value empty">00,000</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-12 lg:mt-16 flex justify-between items-end">
                        <div class="text-[10px] text-gray-400 uppercase tracking-widest">
                            <div>ID <span id="ticket-id" class="font-serif-num ml-1 text-gray-500">000-000</span></div>
                        </div>
                        <div class="w-24 lg:w-32 border-b border-black pb-2 text-right">
                            <span class="font-serif-num text-xs font-bold text-black">Shan Shui</span>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <!-- Mobile Sticky Footer -->
    <div id="mobile-sticky-footer" class="sticky-footer">
        <div class="flex flex-col">
            <span class="text-[9px] text-gray-400 uppercase tracking-widest font-sans font-bold">純框價格</span>
            <span class="font-serif-num text-xl font-bold text-black leading-none mt-1">$ <span id="sticky-price">0</span></span>
        </div>
        <button onclick="document.getElementById('receipt-container').scrollIntoView({behavior: 'smooth'})" class="bg-black text-white px-5 py-2 text-xs font-bold tracking-widest rounded-sm active:scale-95 transition-transform">
            查看總表
        </button>
    </div>

    <!-- Settings Modal -->
    <dialog id="settingsDialog">
        <div class="bg-white p-8">
            <h3 class="text-xl font-bold mb-8 font-serif-num">基價參數設定</h3>
            <div class="space-y-6 text-sm">
                <div>
                    <label class="block mb-2 text-gray-400 font-sans text-xs font-bold tracking-widest">方案 1 (壓克力)</label>
                    <input type="number" id="cfg-price-a" class="w-full border-b border-gray-200 py-2 focus:outline-none focus:border-black transition-colors text-lg font-serif-num" step="0.1">
                </div>
                <div>
                    <label class="block mb-2 text-gray-400 font-sans text-xs font-bold tracking-widest">方案 2 (塑膠板)</label>
                    <input type="number" id="cfg-price-b" class="w-full border-b border-gray-200 py-2 focus:outline-none focus:border-black transition-colors text-lg font-serif-num" step="0.1">
                </div>
                <div>
                    <label class="block mb-2 text-gray-400 font-sans text-xs font-bold tracking-widest">方案 3 (藝術卡紙)</label>
                    <input type="number" id="cfg-price-c" class="w-full border-b border-gray-200 py-2 focus:outline-none focus:border-black transition-colors text-lg font-serif-num" step="0.1">
                </div>
            </div>
            <div class="mt-10 flex justify-end gap-6">
                <button onclick="document.getElementById('settingsDialog').close()" class="text-xs font-bold text-gray-400 hover:text-black tracking-widest py-2">取消</button>
                <button onclick="APP.saveConfig()" class="bg-black text-white px-8 py-3 text-xs font-bold tracking-widest hover:bg-gray-800 rounded-sm">保存設定</button>
            </div>
        </div>
    </dialog>

    <script>
        const APP = (() => {
            const elements = {
                length: document.getElementById('length'),
                width: document.getElementById('width'),
                framePrice: document.getElementById('framePrice'),
                discount: document.getElementById('discountRange'),
                discountDisplay: document.getElementById('discountDisplay'),
                dispL: document.getElementById('disp-l'),
                dispW: document.getElementById('disp-w'),
                dispP: document.getElementById('disp-p'),
                quickPrice: document.getElementById('quick-price-display'),
                stickyPrice: document.getElementById('sticky-price'),
                stickyFooter: document.getElementById('mobile-sticky-footer'),
                priceA: document.getElementById('price-a'),
                priceB: document.getElementById('price-b'),
                priceC: document.getElementById('price-c'),
                oldPriceA: document.getElementById('old-price-a'),
                oldPriceB: document.getElementById('old-price-b'),
                oldPriceC: document.getElementById('old-price-c'),
                cfgA: document.getElementById('cfg-price-a'),
                cfgB: document.getElementById('cfg-price-b'),
                cfgC: document.getElementById('cfg-price-c'),
                dialog: document.getElementById('settingsDialog'),
                date: document.getElementById('receipt-date'),
                ticketId: document.getElementById('ticket-id')
            };

            let config = { priceA: 150, priceB: 130, priceC: 200 };
            const formatter = new Intl.NumberFormat('en-US', { maximumFractionDigits: 0 });

            const updateText = (el, value, isMoney = false) => {
                if (value > 0) {
                    el.textContent = isMoney ? formatter.format(value) : value;
                    el.classList.replace('empty', 'filled');
                } else {
                    el.textContent = isMoney ? "00,000" : "00";
                    el.classList.replace('filled', 'empty');
                }
            };

            const calculate = () => {
                const L = parseFloat(elements.length.value) || 0;
                const W = parseFloat(elements.width.value) || 0;
                const P = parseFloat(elements.framePrice.value) || 0;
                const D = parseFloat(elements.discount.value) || 100;

                elements.discountDisplay.textContent = D;
                
                updateText(elements.dispL, L);
                updateText(elements.dispW, W);
                updateText(elements.dispP, P, true);

                elements.stickyFooter.classList.toggle('visible', L > 0 && W > 0);

                if (L > 0 && W > 0) {
                    const frameTotal = (L + W) * 2 * P;
                    const area = L * W;
                    const discountFactor = D / 100;

                    // 純框價格 (Frame Only) 計算與折扣
                    const finalFrameOnly = frameTotal * discountFactor;
                    const formattedFrameOnly = formatter.format(Math.round(finalFrameOnly));
                    
                    elements.quickPrice.textContent = formattedFrameOnly;
                    elements.stickyPrice.textContent = formattedFrameOnly;

                    const prices = [
                        frameTotal + (area * config.priceA),
                        frameTotal + (area * config.priceB),
                        frameTotal + (area * config.priceC)
                    ];

                    const updatePlan = (elPrice, elOldPrice, rawPrice) => {
                        updateText(elPrice, Math.round(rawPrice * discountFactor), true);
                        elOldPrice.textContent = D < 100 ? `$ ${formatter.format(Math.round(rawPrice))}` : "";
                    };

                    updatePlan(elements.priceA, elements.oldPriceA, prices[0]);
                    updatePlan(elements.priceB, elements.oldPriceB, prices[1]);
                    updatePlan(elements.priceC, elements.oldPriceC, prices[2]);

                } else {
                    ["priceA", "priceB", "priceC"].forEach(k => updateText(elements[k], 0, true));
                    ["oldPriceA", "oldPriceB", "oldPriceC"].forEach(k => elements[k].textContent = "");
                    elements.quickPrice.textContent = "0";
                    elements.stickyPrice.textContent = "0";
                }
            };

            return {
                init: () => {
                    const savedCfg = localStorage.getItem('g_cfg_pure');
                    if(savedCfg) config = JSON.parse(savedCfg);

                    const d = new Date();
                    elements.date.textContent = d.toLocaleDateString('en-US', {year:'numeric', month:'2-digit', day:'2-digit'}).replace(/\//g, '.');
                    elements.ticketId.textContent = Math.floor(Math.random() * 900000 + 100000);

                    [elements.length, elements.width, elements.framePrice, elements.discount].forEach(el => {
                        el.addEventListener('input', calculate);
                    });

                    elements.length.focus();
                    calculate();
                    
                    // ✨ FIX: 簡化淡入動畫，解決閃爍問題
                    setTimeout(() => {
                        document.body.style.opacity = '1';
                    }, 50);
                },
                
                toggleSettings: () => {
                    if (elements.dialog.open) {
                        elements.dialog.close();
                    } else {
                        elements.cfgA.value = config.priceA;
                        elements.cfgB.value = config.priceB;
                        elements.cfgC.value = config.priceC;
                        elements.dialog.showModal();
                    }
                },

                saveConfig: () => {
                    const getVal = el => parseFloat(el.value);
                    const vA = getVal(elements.cfgA), vB = getVal(elements.cfgB), vC = getVal(elements.cfgC);
                    
                    if (!isNaN(vA)) config.priceA = vA;
                    if (!isNaN(vB)) config.priceB = vB;
                    if (!isNaN(vC)) config.priceC = vC;

                    localStorage.setItem('g_cfg_pure', JSON.stringify(config));
                    elements.dialog.close();
                    calculate();
                }
            };
        })();

        window.addEventListener('DOMContentLoaded', APP.init);
    </script>
</body>
</html>
