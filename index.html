<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ¥µè‡´å±±æ°´ Â· æ•¸ä½è—å»Šç³»çµ±</title>
    <meta name="theme-color" content="#F6EDE1">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Old+Mincho:wght@400;700;900&family=Noto+Sans+JP:wght@300;500&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* --- æ–‡æˆ¿è‰²å½©ç³»çµ± (Bunpou) --- */
            --bg-paper: #F6EDE1;       /* é³¥ã®å­è‰²ï¼šä¸»èƒŒæ™¯ */
            --bg-paper-aged: #E9E5DA;  /* é™³å¹´å’Œç´™ï¼šæ·±è‰²èƒŒæ™¯ */
            --text-ink: #2B2B2B;       /* æ¿ƒå¢¨ï¼šä¸»æ–‡å­— */
            --text-wash: #554B3F;      /* æ·¡å¢¨ï¼šæ¬¡è¦æ–‡å­— */
            --accent-seal: #E34234;    /* ç¡ƒç ‚ï¼šå¼·èª¿è‰² */
            --accent-gold: #CD9575;    /* é‡‘ç¹¼ï¼šç„¦é»è‰² */
            
            /* --- ç‰©ç†åƒæ•¸ --- */
            --spring-heavy: cubic-bezier(0.175, 0.885, 0.32, 1.1); /* æ¸›å°‘å›å½ˆï¼Œå¢åŠ é‡é‡æ„Ÿ */
        }

        /* å…¨å±€å­—é«”è¨­å®š */
        body {
            font-family: 'Zen Old Mincho', 'Noto Serif TC', serif; /* æ˜æœé«” */
            background-color: var(--bg-paper-aged); /* å¤–åœæ·±è‰²ï¼Œå‡¸é¡¯å¡ç‰‡ */
            color: var(--text-ink);
            -webkit-font-smoothing: antialiased;
            overflow-x: hidden;
            touch-action: manipulation;
        }

        /* å™ªé»ç´‹ç†ï¼šæ¨¡æ“¬å®£ç´™çº–ç¶­ */
        .washi-texture {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 50;
            pointer-events: none;
            opacity: 0.04;
            mix-blend-mode: multiply;
            background-image: url('data:image/svg+xml;utf8,%3Csvg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg"%3E%3Cfilter id="noiseFilter"%3E%3CfeTurbulence type="fractalNoise" baseFrequency="0.8" numOctaves="3" stitchTiles="stitch"/%3E%3C/filter%3E%3Crect width="100%25" height="100%25" filter="url(%23noiseFilter)"/%3E%3C/svg%3E');
        }

        /* æ°´å¢¨å±±æ°´èƒŒæ™¯ï¼šæ›´æŠ½è±¡ã€æ›´æµå‹• */
        .ink-mountain {
            position: fixed; bottom: 0; left: 0; width: 100%; height: 45vh;
            background: linear-gradient(to top, #dcd5ca, transparent);
            mask-image: linear-gradient(to top, black 40%, transparent 100%);
            -webkit-mask-image: linear-gradient(to top, black 40%, transparent 100%);
            z-index: -1;
            filter: blur(60px); /* æ¥µåº¦æ¨¡ç³Šï¼Œå½¢æˆæšˆæŸ“æ„Ÿ */
            opacity: 0.8;
        }

        /* å¯¦é«”ç´™å¼µå¡ç‰‡ (Paper Card) */
        /* æ›¿æ›åŸæœ¬çš„æ¯›ç»ç’ƒï¼Œæ”¹ç‚ºå¯¦é«”è³ªæ„Ÿ */
        .paper-card {
            background-color: var(--bg-paper);
            border-radius: 4px; /* å‚³çµ±ç´™å¼µæ²’æœ‰å¤§åœ“è§’ */
            /* å¤šå±¤æ¬¡æ¼«å°„é™°å½±ï¼Œæ¨¡æ“¬æŸ”å…‰ */
            box-shadow: 
                0 2px 4px rgba(43, 43, 43, 0.05),
                0 12px 24px rgba(43, 43, 43, 0.05),
                0 24px 48px rgba(85, 75, 63, 0.08); 
            transition: transform 0.5s var(--spring-heavy), box-shadow 0.5s ease;
            position: relative;
            overflow: hidden; /* è®“å…§éƒ¨è£é£¾ä¸æº¢å‡º */
        }
        
        /* èšç„¦æ™‚çš„æ‡¸æµ®æ„Ÿï¼šåƒç´™è¢«è¼•è¼•æèµ· */
        .paper-card:focus-within {
            transform: translateY(-2px);
            box-shadow: 
                0 4px 8px rgba(43, 43, 43, 0.05),
                0 20px 32px rgba(43, 43, 43, 0.08),
                0 32px 64px rgba(85, 75, 63, 0.12);
        }

        /* è£é£¾æ€§ï¼šè§’è½çš„æ‘ºç—•æˆ–ç´‹è·¯ */
        .paper-card::before {
            content: '';
            position: absolute; top: 0; left: 0; width: 100%; height: 4px;
            background: rgba(85, 75, 63, 0.1); /* é ‚éƒ¨å¾®é™°å½± */
        }

        /* è¼¸å…¥æ¡†ç¾åŒ–ï¼šé‡‘ç¹¼é¢¨æ ¼ (Kintsugi Input) */
        input {
            background: transparent !important;
            border-bottom: 1px solid rgba(85, 75, 63, 0.2) !important; /* æ·¡å¢¨ç·šæ¢ */
            border-radius: 0 !important;
            font-family: 'Noto Sans JP', sans-serif; /* æ•¸å­—èˆ‡è¼¸å…¥ç”¨ç„¡è¥¯ç·šé«” */
            font-weight: 500;
            color: var(--text-ink);
            transition: all 0.4s ease;
        }

        input:focus {
            outline: none;
            border-bottom-color: var(--accent-gold) !important; /* èšç„¦æ™‚è®Šç‚ºé‡‘éŠ…è‰² */
            box-shadow: 0 4px 12px -4px rgba(205, 149, 117, 0.2); /* é‡‘è‰²å…‰æšˆ */
        }

        label {
            font-family: 'Noto Sans JP', sans-serif;
            color: var(--text-wash);
            letter-spacing: 0.15em;
        }

        /* æ•¸å€¼è®ŠåŒ–å‹•ç•« */
        .price-value {
            font-variant-numeric: tabular-nums;
            font-feature-settings: "tnum";
            transition: color 0.2s;
        }

        /* ç¡ƒç ‚å°æŒ‰éˆ• (Cinnabar Seal Button) */
        .btn-seal {
            background-color: var(--accent-seal);
            color: white;
            border-radius: 4px; /* å°ç« é€šå¸¸æ˜¯æ–¹å½¢æˆ–å¾®åœ“è§’ */
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 20px rgba(227, 66, 52, 0.25);
            transition: all 0.3s var(--spring-heavy);
        }

        .btn-seal::after {
            content: '';
            position: absolute; inset: 0;
            background: radial-gradient(circle, transparent 30%, rgba(0,0,0,0.1) 100%); /* å°æ³¥çš„è³ªæ„Ÿ */
        }

        .btn-seal:active {
            transform: scale(0.96);
            box-shadow: 0 2px 10px rgba(227, 66, 52, 0.2);
        }

        /* æ¨¡å¼åˆ‡æ›é‚è¼¯ */
        .receipt-mode .no-print { display: none !important; }
        .receipt-mode .print-only { display: block !important; }
        .receipt-mode { background: #fff !important; }
        .print-only { display: none; }
        
        .receipt-mode main { padding-bottom: 0 !important; max-width: 600px; }
    </style>
</head>
<body class="min-h-screen">

    <div class="washi-texture"></div>
    
    <div class="ink-mountain"></div>

    <nav class="p-8 flex justify-between items-center no-print relative z-10">
        <div class="group cursor-pointer">
            <h1 class="text-2xl font-black tracking-[0.2em] text-[#2B2B2B]" style="writing-mode: horizontal-tb;">
                å±±æ°´<span class="text-[#CD9575] mx-2">Â·</span>è—å»Š
            </h1>
            <p class="text-[9px] text-[#554B3F] tracking-[0.4em] uppercase mt-1 opacity-60">Minimalist Gallery</p>
        </div>
        <button onclick="toggleSettings(true)" aria-label="ç³»çµ±è¨­å®š" class="w-12 h-12 rounded-full flex items-center justify-center hover:bg-[#2B2B2B] hover:text-[#F6EDE1] transition-colors duration-500 text-[#2B2B2B]">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <circle cx="12" cy="12" r="3"></circle>
                <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
            </svg>
        </button>
    </nav>

    <aside id="settings-drawer" class="fixed inset-0 z-[100] no-print flex justify-end invisible opacity-0 transition-all duration-500">
        <div class="absolute inset-0 bg-[#2B2B2B]/20 backdrop-blur-sm" onclick="toggleSettings(false)"></div>
        <div class="relative w-full max-w-sm bg-[#F6EDE1] h-full p-10 shadow-2xl transform translate-x-full transition-transform duration-500 overflow-y-auto border-l border-[#E9E5DA]">
            <h2 class="text-xl font-bold mb-10 flex items-center tracking-widest text-[#2B2B2B]">
                <span class="w-8 h-[2px] bg-[#CD9575] mr-4"></span> åƒæ•¸è¨­å®š
            </h2>
            <div class="space-y-8">
                <div class="group">
                    <label class="text-[10px] uppercase block group-focus-within:text-[#CD9575] transition-colors">å£“å…‹åŠ›åŸºåƒ¹</label>
                    <input type="number" id="cfg-price-a" class="w-full py-2 text-lg">
                </div>
                <div class="group">
                    <label class="text-[10px] uppercase block group-focus-within:text-[#CD9575] transition-colors">å¡‘è† æ¿åŸºåƒ¹</label>
                    <input type="number" id="cfg-price-b" class="w-full py-2 text-lg">
                </div>
                <div class="group">
                    <label class="text-[10px] uppercase block group-focus-within:text-[#CD9575] transition-colors">è—è¡“å¡ç´™åŸºåƒ¹</label>
                    <input type="number" id="cfg-price-c" class="w-full py-2 text-lg">
                </div>
            </div>
            <button onclick="saveSettings()" class="w-full bg-[#2B2B2B] text-[#F6EDE1] font-medium py-5 mt-16 shadow-lg hover:bg-black transition-all tracking-[0.2em]">
                ç¢ºèªè®Šæ›´
            </button>
        </div>
    </aside>

    <main class="max-w-lg mx-auto p-6 pb-40 relative z-10">
        
        <section class="paper-card p-10 mb-8 no-print">
            <div class="grid grid-cols-2 gap-x-8 gap-y-10">
                <div>
                    <label class="text-[10px] uppercase mb-2 block">é•·åº¦ (CM)</label>
                    <input type="number" id="length" inputmode="decimal" class="w-full text-2xl py-1">
                </div>
                <div>
                    <label class="text-[10px] uppercase mb-2 block">å¯¬åº¦ (CM)</label>
                    <input type="number" id="width" inputmode="decimal" class="w-full text-2xl py-1">
                </div>
                <div class="col-span-2">
                    <label class="text-[10px] uppercase mb-2 block">æ¡†æ¢å–®åƒ¹ ($)</label>
                    <input type="number" id="framePrice" inputmode="decimal" class="w-full text-2xl py-1 text-[#CD9575]">
                </div>
            </div>
        </section>

        <div class="space-y-6 px-4">
            <div class="print-only text-center py-10">
                <h1 class="text-3xl font-bold mb-4 tracking-[0.2em]">å ±åƒ¹å–®</h1>
                <p id="receipt-date" class="text-[#554B3F] text-[10px] tracking-widest uppercase"></p>
                <div class="h-[1px] w-12 bg-[#CD9575] mx-auto my-6"></div>
                <p id="receipt-spec" class="text-lg font-serif italic mb-10"></p>
            </div>

            <div class="flex justify-between items-end border-b border-[#E9E5DA] pb-5 group cursor-default">
                <div>
                    <h3 class="font-bold text-lg text-[#2B2B2B] group-hover:translate-x-1 transition-transform duration-500">å£“å…‹åŠ›</h3>
                    <p class="text-[9px] text-[#554B3F] uppercase tracking-[0.2em] mt-1 opacity-70">Plan A</p>
                </div>
                <div class="text-right">
                    <p id="old-1-2" class="text-[10px] text-[#CD9575] line-through mb-1 opacity-60"></p>
                    <p id="total-1-2" class="price-value text-2xl font-medium leading-none tracking-tight">$ 0</p>
                </div>
            </div>

            <div class="flex justify-between items-end border-b border-[#E9E5DA] pb-5 group cursor-default">
                <div>
                    <h3 class="font-bold text-lg text-[#2B2B2B] group-hover:translate-x-1 transition-transform duration-500">PS å¡‘è† æ¿</h3>
                    <p class="text-[9px] text-[#554B3F] uppercase tracking-[0.2em] mt-1 opacity-70">Plan B</p>
                </div>
                <div class="text-right">
                    <p id="old-1-3" class="text-[10px] text-[#CD9575] line-through mb-1 opacity-60"></p>
                    <p id="total-1-3" class="price-value text-2xl font-medium leading-none tracking-tight">$ 0</p>
                </div>
            </div>

            <div class="flex justify-between items-end border-b border-[#E9E5DA] pb-5 group cursor-default">
                <div>
                    <h3 class="font-bold text-lg text-[#2B2B2B] group-hover:translate-x-1 transition-transform duration-500">è—è¡“å¡ç´™</h3>
                    <p class="text-[9px] text-[#554B3F] uppercase tracking-[0.2em] mt-1 opacity-70">Plan C</p>
                </div>
                <div class="text-right">
                    <p id="old-1-4" class="text-[10px] text-[#CD9575] line-through mb-1 opacity-60"></p>
                    <p id="total-1-4" class="price-value text-2xl font-medium leading-none tracking-tight">$ 0</p>
                </div>
            </div>
        </div>

        <section class="paper-card p-6 mt-12 no-print flex items-center justify-between">
            <div class="flex flex-col">
                <span class="text-[10px] font-bold text-[#CD9575] tracking-widest uppercase mb-1">Discount</span>
                <div class="font-bold flex items-baseline">
                    <input type="number" id="discountInput" value="100" class="w-12 text-2xl !p-0 !border-0 focus:!border-0 bg-transparent text-[#2B2B2B]">
                    <span class="text-xs ml-1 font-bold text-[#554B3F]">%</span>
                </div>
            </div>
            <div class="w-1/2">
                <input type="range" id="discountRange" min="30" max="100" value="100" step="5" class="w-full h-[2px] bg-[#E9E5DA] appearance-none rounded-full accent-[#2B2B2B] cursor-pointer">
            </div>
        </section>
    </main>

    <div class="fixed bottom-10 left-1/2 -translate-x-1/2 w-full px-6 max-w-sm no-print z-50">
        <button onclick="toggleReceipt()" class="btn-seal w-full py-4 flex items-center justify-center space-x-3 group">
            <span id="btn-icon" class="text-lg opacity-80 group-hover:rotate-12 transition-transform">ğŸ“„</span> 
            <span id="btn-text" class="text-xs tracking-[0.3em] font-medium uppercase text-white">Share Quotation</span>
        </button>
    </div>

    <script>
        // --- é‚è¼¯ä¿æŒä¸è®Šï¼Œç¢ºä¿åŠŸèƒ½å®Œæ•´ ---
        let config = { priceA: 150, priceB: 130, priceC: 200 };

        const load = () => {
            const savedCfg = localStorage.getItem('g_cfg_v2'); 
            if(savedCfg) config = JSON.parse(savedCfg);
            
            ['a','b','c'].forEach(k => {
                const el = document.getElementById(`cfg-price-${k}`);
                if(el) el.value = config[`price${k.toUpperCase()}`];
            });

            ['length', 'width', 'framePrice', 'discountRange'].forEach(id => {
                const v = localStorage.getItem(`g_val_v2_${id}`); 
                if(v) document.getElementById(id).value = v;
            });
            calculate();
        };

        const saveSettings = () => {
            ['A','B','C'].forEach(k => {
                config[`price${k}`] = parseFloat(document.getElementById(`cfg-price-${k.toLowerCase()}`).value) || 0;
            });
            localStorage.setItem('g_cfg_v2', JSON.stringify(config));
            toggleSettings(false);
            calculate();
        };

        const calculate = () => {
            const L = parseFloat(document.getElementById('length').value) || 0;
            const W = parseFloat(document.getElementById('width').value) || 0;
            const P = parseFloat(document.getElementById('framePrice').value) || 0;
            const D = parseFloat(document.getElementById('discountRange').value) || 100;
            
            document.getElementById('discountInput').value = D;

            localStorage.setItem('g_val_v2_length', L);
            localStorage.setItem('g_val_v2_width', W);
            localStorage.setItem('g_val_v2_framePrice', P);
            localStorage.setItem('g_val_v2_discountRange', D);

            if (L <= 0 || W <= 0) return;

            const frameTotal = (L + W) * 2 * P;
            const area = L * W;
            const plans = [
                frameTotal + (area * config.priceA),
                frameTotal + (area * config.priceB),
                frameTotal + (area * config.priceC)
            ];

            const fmt = (v) => `$ ${Math.round(v).toLocaleString()}`;
            
            [['total-1-2','old-1-2'],['total-1-3','old-1-3'],['total-1-4','old-1-4']].forEach((ids, i) => {
                const totalEl = document.getElementById(ids[0]);
                const oldEl = document.getElementById(ids[1]);
                
                const discountedPrice = plans[i] * (D/100);
                
                totalEl.innerText = fmt(discountedPrice);
                oldEl.innerText = D < 100 ? fmt(plans[i]) : "";
            });

            document.getElementById('receipt-spec').innerText = `${L} Ã— ${W} CM / $${P}`;
        };

        function toggleSettings(open) {
            const drawer = document.getElementById('settings-drawer');
            const drawerContent = drawer.querySelector('div:last-child');
            if(open) {
                drawer.classList.remove('invisible', 'opacity-0');
                drawerContent.classList.remove('translate-x-full');
            } else {
                drawer.classList.add('opacity-0');
                drawerContent.classList.add('translate-x-full');
                setTimeout(() => drawer.classList.add('invisible'), 500);
            }
        }

        function toggleReceipt() {
            const isR = document.body.classList.toggle('receipt-mode');
            document.getElementById('btn-text').innerText = isR ? "Edit Data" : "Share Quotation";
            document.getElementById('btn-icon').innerText = isR ? "â†©" : "ğŸ“„";
            if(isR) {
                document.getElementById('receipt-date').innerText = new Date().toLocaleDateString('zh-TW', {year:'numeric',month:'long',day:'numeric'});
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        ['length','width','framePrice','discountRange'].forEach(id => {
            document.getElementById(id).addEventListener('input', calculate);
        });

        window.onload = load;
    </script>
</body>
</html>
