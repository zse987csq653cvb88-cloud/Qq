<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>畫廊報價 Pro</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="畫廊報價">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/3593/3593444.png">
    <meta name="theme-color" content="#0f172a">

    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* 修正 IDE 警告：補齊標準 appearance 屬性 */
        input::-webkit-outer-spin-button, 
        input::-webkit-inner-spin-button { 
            -webkit-appearance: none; 
            appearance: none; 
            margin: 0; 
        }

        input[type=number] { 
            -moz-appearance: textfield; 
            appearance: textfield;
        }
        
        /* 自定義滑軌樣式補齊相容性 */
        .range-input {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 8px;
            outline: none;
        }

        .range-input::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            background: #3b82f6;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }

        /* 防止手機端選取文字與長按選單影響操作 */
        body { 
            -webkit-tap-highlight-color: transparent; 
            user-select: none; 
            overscroll-behavior-y: contain; /* 防止下拉重新整理 */
        }
        input { user-select: auto; }

        .solution-card { transition: all 0.2s ease; }
        .solution-card:active { transform: scale(0.97); opacity: 0.9; }
    </style>
</head>
<body class="bg-slate-50 min-h-screen pb-12 font-sans text-slate-900">

    <nav class="bg-slate-900 text-white p-4 sticky top-0 z-50 shadow-md flex justify-between items-center">
        <div class="flex items-center space-x-2">
            <span class="text-2xl text-blue-400">⚖️</span>
            <div>
                <h1 class="text-sm font-bold leading-none tracking-tight">畫廊專業估價</h1>
                <span class="text-[9px] text-slate-500 font-mono uppercase">Gallery Expert v1.2.1</span>
            </div>
        </div>
        <div id="discount-badge" class="px-3 py-1 rounded-full text-[11px] font-black bg-slate-700 transition-all duration-300">
            100% 原價
        </div>
    </nav>

    <main class="max-w-md mx-auto p-4 space-y-5">
        
        <section class="bg-white rounded-3xl shadow-sm border border-slate-200 p-6 space-y-4">
            <div class="flex items-center space-x-2 mb-2">
                <div class="w-1 h-4 bg-blue-500 rounded-full"></div>
                <h2 class="text-xs font-black text-slate-400 uppercase tracking-widest">尺寸與框條單價</h2>
            </div>
            
            <div class="grid grid-cols-2 gap-4">
                <div class="col-span-1">
                    <label class="block text-[11px] font-bold text-slate-400 mb-1 ml-1">長度 (cm)</label>
                    <input type="number" id="length" inputmode="decimal" placeholder="0" class="w-full text-xl font-mono p-4 bg-slate-50 border-2 border-slate-50 rounded-2xl focus:border-blue-500 focus:bg-white transition-all outline-none">
                </div>
                <div class="col-span-1">
                    <label class="block text-[11px] font-bold text-slate-400 mb-1 ml-1">寬度 (cm)</label>
                    <input type="number" id="width" inputmode="decimal" placeholder="0" class="w-full text-xl font-mono p-4 bg-slate-50 border-2 border-slate-50 rounded-2xl focus:border-blue-500 focus:bg-white transition-all outline-none">
                </div>
                <div class="col-span-2">
                    <label class="block text-[11px] font-bold text-slate-400 mb-1 ml-1">框條單價 (每公分)</label>
                    <input type="number" id="framePrice" inputmode="decimal" placeholder="請輸入金額" class="w-full text-xl font-mono p-4 bg-slate-50 border-2 border-slate-50 rounded-2xl focus:border-blue-500 focus:bg-white transition-all outline-none">
                </div>
            </div>
        </section>

        <section class="bg-white rounded-3xl shadow-sm border border-slate-200 p-6">
            <div class="flex justify-between items-center mb-6">
                <div class="flex items-center space-x-2">
                    <div class="w-1 h-4 bg-red-500 rounded-full"></div>
                    <h2 class="text-xs font-black text-slate-400 uppercase tracking-widest">成交折扣</h2>
                </div>
                <div class="flex items-center bg-red-50 px-3 py-1 rounded-xl">
                    <input type="number" id="discountInput" value="100" class="w-8 bg-transparent text-center font-black text-red-600 outline-none">
                    <span class="text-xs font-black text-red-600">%</span>
                </div>
            </div>
            <input type="range" id="discountRange" min="30" max="100" value="100" step="5" class="range-input">
        </section>

        <div class="space-y-3">
            <h2 class="text-[10px] font-black text-slate-400 uppercase tracking-[0.2em] ml-2">組合報價方案 (總計)</h2>
            
            <div class="solution-card bg-white p-5 rounded-3xl shadow-sm border border-slate-100 flex justify-between items-center relative overflow-hidden">
                <div class="absolute top-0 left-0 w-2 h-full bg-blue-500"></div>
                <div>
                    <h3 class="font-bold text-slate-800 text-base">框條 + 壓克力</h3>
                    <p class="text-[10px] text-slate-400 font-medium">組合 (1) + (2)</p>
                </div>
                <div class="text-right">
                    <p id="old-1-2" class="text-[10px] text-slate-300 line-through font-mono"></p>
                    <p id="total-1-2" class="text-xl font-black text-blue-600 font-mono leading-none mt-1">NT$ 0</p>
                </div>
            </div>

            <div class="solution-card bg-white p-5 rounded-3xl shadow-sm border border-slate-100 flex justify-between items-center relative overflow-hidden">
                <div class="absolute top-0 left-0 w-2 h-full bg-emerald-500"></div>
                <div>
                    <h3 class="font-bold text-slate-800 text-base">框條 + PS 塑膠板</h3>
                    <p class="text-[10px] text-slate-400 font-medium">組合 (1) + (3)</p>
                </div>
                <div class="text-right">
                    <p id="old-1-3" class="text-[10px] text-slate-300 line-through font-mono"></p>
                    <p id="total-1-3" class="text-xl font-black text-emerald-600 font-mono leading-none mt-1">NT$ 0</p>
                </div>
            </div>

            <div class="solution-card bg-white p-5 rounded-3xl shadow-sm border border-slate-100 flex justify-between items-center relative overflow-hidden">
                <div class="absolute top-0 left-0 w-2 h-full bg-purple-500"></div>
                <div>
                    <h3 class="font-bold text-slate-800 text-base">框條 + 卡紙</h3>
                    <p class="text-[10px] text-slate-400 font-medium">組合 (1) + (4)</p>
                </div>
                <div class="text-right">
                    <p id="old-1-4" class="text-[10px] text-slate-300 line-through font-mono"></p>
                    <p id="total-1-4" class="text-xl font-black text-purple-600 font-mono leading-none mt-1">NT$ 0</p>
                </div>
            </div>
        </div>

    </main>

    <script>
        const dom = {
            L: document.getElementById('length'),
            W: document.getElementById('width'),
            P: document.getElementById('framePrice'),
            dRange: document.getElementById('discountRange'),
            dInput: document.getElementById('discountInput'),
            badge: document.getElementById('discount-badge'),
            t12: document.getElementById('total-1-2'), o12: document.getElementById('old-1-2'),
            t13: document.getElementById('total-1-3'), o13: document.getElementById('old-1-3'),
            t14: document.getElementById('total-1-4'), o14: document.getElementById('old-1-4'),
        };

        const calculate = (source) => {
            if(source === 'range') dom.dInput.value = dom.dRange.value;
            if(source === 'input') dom.dRange.value = dom.dInput.value;

            const L = parseFloat(dom.L.value) || 0;
            const W = parseFloat(dom.W.value) || 0;
            const P = parseFloat(dom.P.value) || 0;
            const disc = (Math.max(0, Math.min(100, parseFloat(dom.dInput.value) || 0))) / 100;

            // UI 狀態更新
            const isDiscounted = disc < 1;
            dom.badge.innerText = isDiscounted ? `${Math.round(disc*100)}% 優惠` : "100% 原價";
            dom.badge.className = `px-3 py-1 rounded-full text-[11px] font-black transition-all ${isDiscounted ? 'bg-red-500 text-white shadow-lg shadow-red-200' : 'bg-slate-700 text-slate-300'}`;

            if (L <= 0 || W <= 0) return;

            const frame = (L + W) * 2 * P;
            const area = L * W;
            const basePrices = [
                frame + (area * 150), // A: 壓克力
                frame + (area * 130), // B: PS板
                frame + (area * 200)  // C: 卡紙
            ];

            const fmt = (v) => `NT$ ${Math.round(v).toLocaleString()}`;
            
            [ [dom.t12, dom.o12], [dom.t13, dom.o13], [dom.t14, dom.o14] ].forEach((pair, i) => {
                const final = basePrices[i] * disc;
                pair[0].innerText = fmt(final);
                pair[1].innerText = isDiscounted ? fmt(basePrices[i]) : "";
            });
        };

        // 綁定事件
        [dom.L, dom.W, dom.P].forEach(el => el.addEventListener('input', () => calculate()));
        dom.dRange.addEventListener('input', () => calculate('range'));
        dom.dInput.addEventListener('input', () => calculate('input'));
        
        // 禁止雙擊縮放，提升 App 體感
        let lastTouchEnd = 0;
        document.addEventListener('touchend', (e) => {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) e.preventDefault();
            lastTouchEnd = now;
        }, false);
    </script>
</body>
</html>
